### 缓存过期设置

#### 1. maxmemory 不限制过期时间

Redis的key是固定的，不会增加
Redis作为DB使用，保证数据的完整性，不能淘汰 ， 可以做集群，横向扩展
缓存淘汰策略：禁止驱逐 （默认）

Redis是作为缓存使用，不断增加Key
maxmemory ： 默认为0 不限制
问题：超过物理内存后性能急剧下架，甚至崩溃。内存与硬盘交换（swap） 虚拟内存 ，频繁IO 性能急剧下降
设置多少？与业务有关
1个Redis实例，保证系统运行 1 G ，剩下的就都可以设置Redis
如：物理内存的3/4
slaver ： 留出一定的内存
在redis.conf中配置

```
maxmemory 1024mb
```



#### 2. Expire 设置过期

在Redis中可以使用expire命令设置一个键的存活时间(ttl: time to live)，过了这段时间，该键就会自动被删除。



### 缓存删除方策略

Redis的数据删除有定时删除、惰性删除和主动删除三种方式。
Redis目前采用惰性删除+主动删除的方式。

#### 1、定时删除

在设置键的过期时间的同时，创建一个定时器，让定时器在键的过期时间来临时，立即执行对键的删除操作。
需要创建定时器，而且消耗CPU，一般不推荐使用。

#### 2、惰性删除

在key被访问时如果发现它已经失效，那么就删除它。
调用expireIfNeeded函数，该函数的意义是：读取数据之前先检查一下它有没有失效，如果失效了就删除它。

#### 3、主动删除

在redis.conf文件中可以配置主动删除策略,默认是no-enviction（不删除）

```powershell
maxmemory-policy allkeys-lru
```



## **内存淘汰策略**

1. noeviction：当内存使用超过配置的时候会返回错误，不会驱逐任何键

2. allkeys-lru：加入键的时候，如果过限，首先通过LRU算法驱逐最久没有使用的键

3. volatile-lru：加入键的时候如果过限，首先从设置了过期时间的键集合中驱逐最久没有使用的键

4. allkeys-random：加入键的时候如果过限，从所有key随机删除

5. volatile-random：加入键的时候如果过限，从过期键的集合中随机驱逐

6. volatile-ttl：从配置了过期时间的键中驱逐马上就要过期的键

7. volatile-lfu：从所有配置了过期时间的键中驱逐使用频率最少的键

8. allkeys-lfu：从所有键中驱逐使用频率最少的键

